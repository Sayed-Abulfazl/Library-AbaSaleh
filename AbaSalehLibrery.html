<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>کتابخانه مکتب اباصالح</title>
    <style>
        * {
            padding: 0;
            margin: 0;
            box-sizing: border-box;
            list-style-type: none;
            text-decoration: none;
            direction: rtl;
        }

        body {
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            width: 80%;
            max-width: 800px;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            /* background-color: rgba(0, 0, 0, 0.1); */
            border-radius: 20px;
            margin-top: 20px;
            margin-bottom: 100px;
        }

        header,
        main,
        footer {
            width: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        header
         {
            background-color: rgba(250, 231, 206, 0.882);
        }

        header>h1 {
            margin: 30px 0;
            font-size: 32px;
        }

        header {
            border-radius: 20px 20px 0 0;
            min-width: 350px;
        }

        header form input {
            margin-bottom: 10px;
            padding: 5px 15px;
            border: none;
            outline: none;
            font-size: 20px;
            width: 100%;
            max-width: 300px;
            border-radius: 5px;
        }
        main{
            margin-bottom: 120px;
            min-width: 340px;
        }
        main #head {
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        #head span {
            margin-left: 10px;
            font-size: 16px;
        }

        #q {
            font-weight: bold;
            color: green;
        }

        .date {
            direction: ltr;
            font-size: 20px;
            margin-top: 0;
            margin-bottom: 20px;
        }

        main #head>h2 {
            margin: 10px;
        }

        #books-contain {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        #books-contain ul,
        ul li {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        #books-contain ul li {
            flex-direction: row;
            justify-content: space-between;
            text-align: center;
            align-items: center;
            margin: 10px auto;
            padding-right: 8px;
            border-right: 5px solid mintcream;
            transition: all 0.3s;
        }

        #books-contain ul li .nameBook {
            font-size: 20px;
            float: right;
        }

        #books-contain ul li .deleteBook {
            float: left;
            padding: 3px 8px;
            background-color: chocolate;
            color: white;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
        }

        #books-contain ul li:hover {
            border-color: red;
        }

        #books-contain ul li .deleteBook:hover {
            background-color: red;
        }

        #books-contain ul li:active {
            border-color: red;
        }

        #books-contain ul li .deleteBook:active {
            background-color: red;
        }

        main #hide-contain {
            width: 100%;
            margin-right: 30px;
            font-weight: bold;
            margin-block: 10px;
        }

        main #hide-contain #hide {
            margin-left: 10px;
        }


        footer {
            padding-block: 20px;
        }

        footer #addBook-contain form input {
            font-size: 20px;
            padding: 5px 10px;
            border: 1px solid blue;
            outline: none;
            border-radius: 4px;
            margin-right: 20px;
            margin-top: 5px;
        }

        footer #addBook-contain form button {
            font-size: 20px;
            border: none;
            margin-right: 10px;
            cursor: pointer;
            background-color: green;
            color: white;
            font-weight: bold;
            padding: 4px 14px;
            border-radius: 5px;
        }

        footer #addBook-contain form button:active {
            transform: scale(1.1);
        }

        footer {
            position: fixed;
            bottom: 0px;
            min-width: 350px;
            width: 50%;
            background-color: rgba(0, 0, 255, 0.6);
            border-radius: 20px 20px 0 0;
        }

        footer form {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }

        .locBook {
            font-size: 12px;
            font-weight: bold;
        }

        form div {
            position: relative;
        }

        .warnspan {
            font-size: 22px;
            color: red;
            z-index: 2;
            top: 35%;
            position: absolute;
            left: 2%;
            display: none;
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <h1>" کتابخانه مکتب اباصالح "</h1>
            <p class="date"></p>
            <div class="search-contain">
                <form>
                    <input type="text" placeholder="اینجا جستجو کنید ...">
                </form>
            </div>
        </header>
        <main>
            <div id="head">
                <h2 id="headText">فهـــرست کتــاب هـــا</h2>
                <span>
                    تعداد کتاب ها:
                    <span id="q"></span>
                </span>
            </div>

            <div id="books-contain">
                <ul>

                </ul>
            </div>

            <div id="hide-contain">
                <form>
                    <input type="checkbox" id="hide">
                    <label for="hide">مخفی کردن کتاب ها</label>
                </form>
            </div>
        </main>

        <footer>
            <div id="addBook-contain">
                <form>
                    <div>
                        <input autocomplete="off" type="text" id="n" placeholder="کتاب جدید...">
                        <span class="warnspan" id="ws1">*</span>
                    </div>
                    <div>
                        <input autocomplete="off" type="text" id="m" placeholder=" موقعیت کتاب...">
                        <span class="warnspan" id="ws2">*</span>
                    </div>
                    <button class="btn" id="addBook-btn">اضافه</button>
                </form>
            </div>
        </footer>

    </div>
    <script>
        // commons

        const booksContain = document.getElementById('books-contain');
        const headText = document.getElementById('headText');
        const hideButton = document.getElementById('hide');

        const listBooks = document.querySelector('#books-contain ul');

        const addBookInput1 = document.querySelector('#addBook-contain input#n');
        const addBookInput2 = document.querySelector('#addBook-contain input#m');
        const addBookbtn = document.getElementById('addBook-btn')

        const searchBox = document.querySelector('.search-contain input');

        // Hiding Books
        hideButton.addEventListener('click', (e) => {
            if (hideButton.checked) {
                booksContain.style.display = 'none'
                headText.style.display = 'none'
            } else {
                booksContain.style.display = 'block'
                headText.style.display = 'block'
            }
        })

        // Adding book
        // add book in front

        const bookDelete = "<span class='deleteBook'>حذف</span>"

        function returning() {
            if (!addBookInput1.value) {
                addBookInput1.style.borderColor = 'red'
                document.getElementById('ws1').style.display = 'block';
            }
            if (!addBookInput2.value) {
                addBookInput2.style.borderColor = 'red'
                document.getElementById('ws2').style.display = 'block';
            }
            setTimeout(() => {
                addBookInput1.style.borderColor = 'blue'
                addBookInput2.style.borderColor = 'blue'
                document.getElementById('ws1').style.display = 'none';
                document.getElementById('ws2').style.display = 'none';
            }, 2000)
        }

        addBookbtn.addEventListener('click', (e) => {
            e.preventDefault();
            if (!addBookInput1.value || !addBookInput2.value) {
                return returning();
            }
            const bookName = document.createElement('span');
            bookName.className = 'nameBook';
            bookName.innerText = addBookInput1.value;

            const locationBook = document.createElement('span');
            locationBook.className = 'locBook';
            locationBook.innerText = addBookInput2.value;

            let bookli = document.createElement('li');

            bookli.appendChild(bookName);
            bookli.appendChild(locationBook);
            bookli.lastElementChild.insertAdjacentHTML('afterend', bookDelete)




            saveBooksInLocalStorage(addBookInput1.value, addBookInput2.value)

            listBooks.appendChild(bookli)
            addBookInput1.value = '';
            addBookInput2.value = '';

        })


        // add book in back

        let arrayBooks;
        let arrayLocs;

        // Function
        function saveBooksInLocalStorage(inputNameBook, inputLocationBook) {
            if (localStorage.getItem('k') === null) {
                arrayBooks = [];
            } else {
                arrayBooks = localStorage.getItem('k').split(',');
            }
            arrayBooks.push(inputNameBook);

            if (localStorage.getItem('m') === null) {
                arrayLocs = [];
            } else {
                arrayLocs = localStorage.getItem('m').split(',');
            }
            arrayLocs.push(inputLocationBook)

            localStorage.setItem('k', arrayBooks)
            localStorage.setItem('m', arrayLocs)
            document.querySelector('#q').innerText = arrayBooks.length;

        }

        document.addEventListener('DOMContentLoaded', (e) => {
            if (localStorage.getItem('k') === null) {
                arrayBooks = [];
            } else {
                arrayBooks = localStorage.getItem('k').split(',');
            }

            if (localStorage.getItem('m') === null) {
                arrayLocs = [];
            } else {
                arrayLocs = localStorage.getItem('m').split(',');
            }

            for (let index = 0; index < arrayBooks.length; index++) {
                const bookName = document.createElement('span');
                bookName.className = 'nameBook';
                bookName.innerText = arrayBooks[index];

                const locationBook = document.createElement('span');
                locationBook.className = 'locBook';
                locationBook.innerText = arrayLocs[index];

                const bookli = document.createElement('li');

                bookli.appendChild(bookName);
                bookli.appendChild(locationBook);
                bookli.lastElementChild.insertAdjacentHTML('afterend', bookDelete);

                listBooks.appendChild(bookli);
                document.querySelector('#q').innerText = arrayBooks.length;
            }
        })

        // removing book

        // remove book in front

        listBooks.addEventListener('click', (e) => {
            if (e.target.className === 'deleteBook') {
                e.target.parentElement.remove();
                // in back is in this function
                removeBookFromLocalStorage(e.target.parentElement.firstElementChild.innerText)
            }
        })

        // remove book in back

        function removeBookFromLocalStorage(input) {
            if (localStorage.getItem('k') === null) {
                arrayBooks = [];
            } else {
                arrayBooks = localStorage.getItem('k').split(',');
            }

            for (let i = 0; i < arrayBooks.length; i++) {
                if (arrayBooks[i] === input) {
                    arrayBooks.splice(i, 1);
                }
            }

            if (arrayBooks.length === 0) {
                localStorage.clear();
            } else {
                localStorage.setItem('k', arrayBooks);
            }
            document.querySelector('#q').innerText = arrayBooks.length;

        }

        // date
        setInterval(() => {
            const date = new Date();

            const classdate = document.querySelector('.date');

            let h = date.getHours();
            let m = date.getMinutes();
            let s = date.getSeconds();
            let y = date.getFullYear();
            let mm = date.getMonth();
            let d = date.getDate();

            h = h < 10 ? '0' + h : h;
            m = m < 10 ? '0' + m : m;
            s = s < 10 ? '0' + s : s;
            d = d < 10 ? '0' + d : d;
            mm = mm < 10 ? '0' + mm : mm;

            classdate.innerText = `${y}/${mm}/${d} --- ${h}:${m}:${s}`
        }, 1000)

        // searching book

        searchBox.addEventListener('keyup', (e) => {
            for (let index of listBooks.children) {
                if (index.firstElementChild.textContent.indexOf(searchBox.value) !== -1) {
                    index.style.display = 'block'
                } else {
                    index.style.display = 'none'
                }
            }
        })
    </script>
</body>

</html>